#/usr/bin/env bash

BUILDER_DOCKER=nervos/ckb-riscv-gnu-toolchain@sha256:7b168b4b109a0f741078a71b7c4dddaf1d283a5244608f7851f5714fbad273ba

run() {
    echo $1
    docker run --rm -v `pwd`:/code ${BUILDER_DOCKER} \
           bash -c "riscv64-unknown-elf-run /code/build/generator_test $2 $3"
    echo "========"
}

if [ -z "$1" ]
then
    #### Run tests ####
    run "[Run] create CallContract.sol" 84020000 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000023020000000000000000000000c8328aabcd9b9e8e64fbc566c4385c3bdeb219d7c8328aabcd9b9e8e64fbc566c4385c3bdeb219d784fb021b9622482c5ac56cb633e0e990c1d53f7eb201000060806040523480156100115760006000fd5b506004361061003b5760003560e01c806328cc7b2514610041578063cd3840a9146100705761003b565b60006000fd5b61006e600480360360208110156100585760006000fd5b81019080803590602001909291905050506100ba565b005b610078610156565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6000600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690508073ffffffffffffffffffffffffffffffffffffffff166360fe47b1600384016040518263ffffffff1660e01b815260040180828152602001915050600060405180830381600087803b1580156101385760006000fd5b505af115801561014d573d600060003e3d6000fd5b50505050505b50565b600060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168156fea264697066735822122020574f97551b138e078bc0fba20bd35c17863cd03a3d659577e63e5a62f4798064736f6c634300060600332400000028cc7b2500000000000000000000000000000000000000000000000000000000000000de00000000000000000000000000000000000000000000000000000000
else
    run "[Run] custom" $1 $2
fi
