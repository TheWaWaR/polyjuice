#/usr/bin/env bash

BUILDER_DOCKER=nervos/ckb-riscv-gnu-toolchain@sha256:7b168b4b109a0f741078a71b7c4dddaf1d283a5244608f7851f5714fbad273ba

run() {
    echo $1
    docker run --rm -v `pwd`:/code ${BUILDER_DOCKER} \
           bash -c "riscv64-unknown-elf-run /code/build/generator_test $2 $3"
    echo "========"
}

if [ -z "$1" ]
then
    #### Run tests ####
    run "[Run] create SimpleStorage.sol" "7b010000" 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000010101010101010101010101010101010101010102020202020202020202020202020202020202020101000060806040525b607b60006000508190909055505b610018565b60db806100266000396000f3fe60806040526004361060295760003560e01c806360fe47b114602f5780636d4ce63c14605b576029565b60006000fd5b60596004803603602081101560445760006000fd5b81019080803590602001909291905050506084565b005b34801560675760006000fd5b50606e6094565b6040518082815260200191505060405180910390f35b8060006000508190909055505b50565b6000600060005054905060a2565b9056fea26469706673582212204e58804e375d4a732a7b67cce8d8ffa904fa534d4555e655a433ce0a5e0d339f64736f6c6343000606003300000000

    run "[Run] create LogEvents.sol" "af010000" 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000010101010101010101010101010101010101010102020202020202020202020202020202020202023501000060806040525b3373ffffffffffffffffffffffffffffffffffffffff167f33b708096f325a28269900b1f9361f84aa77ba6ca085f6b114e4a070a8239d5234600160405180838152602001821515151581526020019250505060405180910390a25b610066565b60c1806100746000396000f3fe608060405260043610601f5760003560e01c806351973ec914602557601f565b60006000fd5b602b602d565b005b3373ffffffffffffffffffffffffffffffffffffffff167f33b708096f325a28269900b1f9361f84aa77ba6ca085f6b114e4a070a8239d5234600060405180838152602001821515151581526020019250505060405180910390a25b56fea2646970667358221220febe0ec5c064e995607c65adef058679ddef92d16e1fff35675fc3505f8f6b4564736f6c6343000606003300000000
else
    run "[Run] custom" $1 $2
fi
